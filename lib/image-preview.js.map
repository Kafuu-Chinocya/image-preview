{"version":3,"sources":["../js/image-preview.js"],"names":["window","addEventListener","preview","Preview","document","querySelector","e","show","target","src","_ui","tools","createElements","eleName","num","i","createElement","eDistance","x1","y1","x2","y2","Math","sqrt","imgArgs","scale","rotate","translate","updateTransformStyle","imgLayer","style","transform","join","resetImgArgs","console","log","setAttribute","backgroundLayer","classList","add","filterClassList","contains","close","forEach","preventDefault","passive","body","insertBefore","firstElementChild","contentLayer","topBar","contentImgBox","bottomBar","barClass","appendChild","_createBtn","leftRotate","rightRotate","zoomIn","zoomOut","_createImg","btnClass","touches","length","transition","nowTouches","clientX","clientY","nowDistance","oldDistance","v","parseFloat","toFixed","undefined","l","t","isLongClick","offsetLeft","offsetTop","x","y","lt","ls","top","left","detail","wheelDelta","flag","abs","querySelectorAll","createBackgroundLayer","createContentLayer","removeChild","remove","destroy"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nwindow.addEventListener(\"load\", () => {\r\n  const preview = new Preview();\r\n  document\r\n    .querySelector(\"img\")\r\n    .addEventListener(\"click\", (e) => preview.show(e.target.src));\r\n});\r\n\r\n/**\r\n * 预览图组件\r\n * 拥有3个外部调用方法\r\n *      @see show\r\n *      @see close\r\n *      @see destroy\r\n *\r\n * @class\r\n * @author Kafuu_Chino <kafuu_chino@girigiri.love>\r\n */\r\nclass Preview {\r\n  /**\r\n   * @constructor\r\n   */\r\n  constructor() {\r\n    // 构造ui对象\r\n    this._ui = new (class {\r\n      /**\r\n       * 初始化工具包和图片参数\r\n       *\r\n       * @constructor\r\n       */\r\n      constructor() {\r\n        // 工具包\r\n        this.tools = {\r\n          /**\r\n           * 批量创建同类元素\r\n           * @param eleName - 元素标签名\r\n           * @param num - 所需数量\r\n           * @returns {HTMLElement[]}\r\n           */\r\n          createElements(eleName, num) {\r\n            return [\r\n              ...(function* () {\r\n                for (let i = 0; i < num; i++)\r\n                  yield document.createElement(eleName);\r\n              })(),\r\n            ];\r\n          },\r\n          /**\r\n           * 欧几里得距离\r\n           * @param x1\r\n           * @param y1\r\n           * @param x2\r\n           * @param y2\r\n           * @returns {number}\r\n           */\r\n          eDistance([x1, y1], [x2, y2]) {\r\n            return Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2);\r\n          },\r\n        };\r\n        // 图片参数\r\n        this.imgArgs = {\r\n          scale: 1.0,\r\n          rotate: 0,\r\n          translate: [\"-50%\", \"-50%\"],\r\n          src: \"\",\r\n          // 更新当前transform style样式\r\n          updateTransformStyle: () =>\r\n            (this.imgLayer.style.transform = `translate(${this.translate.join(\r\n              \",\"\r\n            )}) scale(${this.scale}) rotate(${this.rotate}deg)`),\r\n          // 重置图片样式和imgLayer对象参数为默认值\r\n          resetImgArgs: () => {\r\n            console.log(this.imgLayer);\r\n            this.imgLayer.setAttribute(\"style\", \"\");\r\n            this.scale = 1.0;\r\n            this.rotate = 0;\r\n            this.translate = [\"-50%\", \"-50%\"];\r\n          },\r\n        };\r\n      }\r\n\r\n      // 图片参数getter/setter 操作集\r\n      get src() {\r\n        return this.imgArgs.src;\r\n      }\r\n\r\n      set src(v) {\r\n        this.imgArgs.src = v;\r\n        this.imgArgs.resetImgArgs();\r\n        this.imgLayer.src = v;\r\n        if (this.backgroundLayer.classList.contains(\"close\"))\r\n          this.backgroundLayer.classList.remove(\"close\");\r\n      }\r\n\r\n      get scale() {\r\n        return this.imgArgs.scale;\r\n      }\r\n\r\n      set scale(v) {\r\n        // 处理浮点数\r\n        this.imgArgs.scale = parseFloat(v.toFixed(2));\r\n        // 缩放最小倍率为0.5\r\n        if (Math.abs(v) <= 0.5) this.imgArgs.scale = 0.5;\r\n        this.imgArgs.updateTransformStyle();\r\n      }\r\n\r\n      get rotate() {\r\n        return this.imgArgs.rotate;\r\n      }\r\n\r\n      set rotate(v) {\r\n        this.imgArgs.rotate = v;\r\n        this.imgArgs.updateTransformStyle();\r\n      }\r\n\r\n      get translate() {\r\n        return this.imgArgs.translate;\r\n      }\r\n\r\n      set translate(v) {\r\n        if (v.length === 2) this.imgArgs.translate = v;\r\n      }\r\n\r\n      /**\r\n       * 创建背景盒子\r\n       */\r\n      createBackgroundLayer() {\r\n        // 创建preview-background-layer盒子\r\n        this.backgroundLayer = document.createElement(\"div\");\r\n        this.backgroundLayer.classList.add(\"preview-background-layer\");\r\n\r\n        // 点击背景部分关闭\r\n        this.backgroundLayer.addEventListener(\"click\", (e) => {\r\n          const filterClassList = [\"iconfont\", \"preview-img\"];\r\n          for (let i of filterClassList) {\r\n            if (e.target.classList.contains(i)) return;\r\n          }\r\n          this.close();\r\n        });\r\n\r\n        // 禁止页面滚动\r\n        [\"mousewheel\", \"DOMMouseScroll\", \"touchmove\"].forEach((i) => {\r\n          this.backgroundLayer.addEventListener(\r\n            i,\r\n            (e) => {\r\n              e.preventDefault();\r\n            },\r\n            { passive: false }\r\n          );\r\n        });\r\n\r\n        document.body.insertBefore(\r\n          this.backgroundLayer,\r\n          document.body.firstElementChild\r\n        );\r\n      }\r\n\r\n      /**\r\n       * 创建内容载体盒子\r\n       */\r\n      createContentLayer() {\r\n        // 创建content-layer-box盒子\r\n        this.contentLayer = document.createElement(\"div\");\r\n        this.contentLayer.classList.add(\"content-layer-box\");\r\n\r\n        // 创建top-bar，bottom-bar，content-img-box盒子，并赋予相同的class\r\n        const [topBar, contentImgBox, bottomBar] = this.tools.createElements(\r\n          \"div\",\r\n          3\r\n        );\r\n        const barClass = [\"top-bar\", \"content-img-box\", \"bottom-bar\"];\r\n        [topBar, contentImgBox, bottomBar].forEach((e, i) => {\r\n          e.classList.add(barClass[i]);\r\n          this.contentLayer.appendChild(e);\r\n        });\r\n\r\n        // 创建按钮集合\r\n        const [close, leftRotate, rightRotate, zoomIn, zoomOut] =\r\n          this._createBtn();\r\n\r\n        // 将相应元素添加至各自节点\r\n        topBar.appendChild(close);\r\n        contentImgBox.appendChild(this._createImg());\r\n        [leftRotate, rightRotate, zoomIn, zoomOut].forEach((e) =>\r\n          bottomBar.appendChild(e)\r\n        );\r\n\r\n        this.backgroundLayer.appendChild(this.contentLayer);\r\n      }\r\n\r\n      /**\r\n       * 创建按钮集合，只能由createContentLayer调用\r\n       *\r\n       * @returns {HTMLElement[]}\r\n       * @private\r\n       * @see createContentLayer\r\n       */\r\n      _createBtn() {\r\n        // 创建5组按钮，并赋予相同的class，并编写事件\r\n        const [close, leftRotate, rightRotate, zoomIn, zoomOut] =\r\n          this.tools.createElements(\"span\", 5);\r\n        const btnClass = [\r\n          \"icon-close\",\r\n          \"icon-left-rotate\",\r\n          \"icon-right-rotate\",\r\n          \"icon-zoom-in\",\r\n          \"icon-zoom-out\",\r\n        ];\r\n        [close, leftRotate, rightRotate, zoomIn, zoomOut].forEach((e, i) => {\r\n          e.classList.add(\"iconfont\", btnClass[i]);\r\n        });\r\n        // 关闭按钮\r\n        close.addEventListener(\"click\", () => this.close());\r\n        // 左旋转\r\n        leftRotate.addEventListener(\"click\", () => (this.rotate -= 90));\r\n        // 右旋转\r\n        rightRotate.addEventListener(\"click\", () => (this.rotate += 90));\r\n        // 放大图片\r\n        zoomIn.addEventListener(\"click\", () => (this.scale += 0.2));\r\n        // 缩小图片\r\n        zoomOut.addEventListener(\"click\", () => (this.scale -= 0.2));\r\n        return [close, leftRotate, rightRotate, zoomIn, zoomOut];\r\n      }\r\n\r\n      /**\r\n       *\r\n       * 创建图片对象，只能由createContentLayer调用\r\n       * @returns {HTMLImageElement}\r\n       * @private\r\n       * @see createContentLayer\r\n       */\r\n      _createImg() {\r\n        this.imgLayer = document.createElement(\"img\");\r\n        this.imgLayer.classList.add(\"preview-img\");\r\n        this.imgLayer.setAttribute(\"draggable\", \"false\");\r\n\r\n        // 触摸坐标集合\r\n        let touches;\r\n\r\n        // 双指缩放\r\n        this.contentLayer.addEventListener(\"touchmove\", (e) => {\r\n          if (e.touches.length === 2) {\r\n            this.imgLayer.style.transition = `none`;\r\n\r\n            const nowTouches = [\r\n              [e.touches[0].clientX, e.touches[0].clientY],\r\n              [e.touches[1].clientX, e.touches[1].clientY],\r\n            ];\r\n\r\n            if (touches && touches.length) {\r\n              // 计算距离\r\n              const nowDistance = this.tools.eDistance(\r\n                nowTouches[0],\r\n                nowTouches[1]\r\n              );\r\n              const oldDistance = this.tools.eDistance(touches[0], touches[1]);\r\n\r\n              if (nowDistance === oldDistance) return;\r\n              // 缩放比例\r\n              const v = parseFloat((nowDistance / oldDistance / 10).toFixed(2));\r\n              nowDistance > oldDistance ? (this.scale += v) : (this.scale -= v);\r\n            }\r\n            touches = nowTouches;\r\n          }\r\n        });\r\n        this.contentLayer.addEventListener(\"touchend\", (e) => {\r\n          touches = undefined;\r\n          this.imgLayer.style.transition = `transform .3s`;\r\n        });\r\n\r\n        //按下的坐标\r\n        let x1;\r\n        let y1;\r\n        //元素的left，top值\r\n        let l;\r\n        let t;\r\n        // 是否长按\r\n        let isLongClick = false;\r\n\r\n        // 鼠标按下/触摸开始 事件 图片绑定鼠标移动事件\r\n        [\"mousedown\", \"touchstart\"].forEach((i) => {\r\n          this.imgLayer.addEventListener(i, (e) => {\r\n            e.preventDefault();\r\n            isLongClick = true;\r\n            this.imgLayer.style.transition = `none`;\r\n            x1 = e.touches ? e.touches[0].clientX : e.clientX;\r\n            y1 = e.touches ? e.touches[0].clientY : e.clientY;\r\n            l = this.imgLayer.offsetLeft;\r\n            t = this.imgLayer.offsetTop;\r\n          });\r\n        });\r\n\r\n        // 鼠标/触摸 移动方法\r\n        [\"mousemove\", \"touchmove\"].forEach((i) => {\r\n          this.imgLayer.addEventListener(i, (e) => {\r\n            e.preventDefault();\r\n            if (isLongClick) {\r\n              this.imgLayer.style.transition = `none`;\r\n\r\n              //获取鼠标移动时的坐标\r\n              const x2 = e.touches ? e.touches[0].clientX : e.clientX;\r\n              const y2 = e.touches ? e.touches[0].clientY : e.clientY;\r\n\r\n              //计算出鼠标的移动距离\r\n              const x = x2 - x1;\r\n              const y = y2 - y1;\r\n\r\n              //移动的数值与元素的left，top相加，得出元素的移动的距离\r\n              const lt = y + t;\r\n              const ls = x + l;\r\n\r\n              //更改元素的left，top值\r\n              this.imgLayer.style.top = lt + \"px\";\r\n              this.imgLayer.style.left = ls + \"px\";\r\n            }\r\n          });\r\n        });\r\n\r\n        // 鼠标松开 / 移出 / 触摸结束 事件 解绑鼠标移动事件\r\n        [\"mouseup\", \"mouseleave\", \"touchend\"].forEach((i) => {\r\n          this.imgLayer.addEventListener(i, (e) => {\r\n            e.preventDefault();\r\n            isLongClick = false;\r\n            this.imgLayer.style.transition = `transform .3s`;\r\n          });\r\n        });\r\n\r\n        // 缩放事件\r\n        [\"mousewheel\", \"DOMMouseScroll\"].forEach((i) => {\r\n          this.contentLayer.addEventListener(i, (e) => {\r\n            // 兼容火狐\r\n            let detail = e.detail ? e.detail : e.wheelDelta;\r\n            // 判断浏览器类型\r\n            let flag = Math.abs(detail) === 120;\r\n\r\n            // 根据浏览器类型赋值\r\n            if (flag) detail > 0 ? (this.scale += 0.1) : (this.scale -= 0.1);\r\n            else detail > 0 ? (this.scale -= 0.1) : (this.scale += 0.1);\r\n          });\r\n        });\r\n\r\n        return this.imgLayer;\r\n      }\r\n\r\n      /**\r\n       * 开启预览图窗口\r\n       * @param src - 原图路径或是base64编码\r\n       */\r\n      show(src) {\r\n        // 预览图元素是首次被创建\r\n        if (!document.querySelectorAll(\".preview-background-layer\").length) {\r\n          this.createBackgroundLayer();\r\n          this.createContentLayer();\r\n        }\r\n\r\n        this.src = src;\r\n      }\r\n\r\n      /**\r\n       * 关闭预览图窗口\r\n       */\r\n      close() {\r\n        this.backgroundLayer.classList.add(\"close\");\r\n      }\r\n\r\n      /**\r\n       * 销毁对象\r\n       */\r\n      destroy() {\r\n        document.body.removeChild(this.backgroundLayer);\r\n      }\r\n    })();\r\n  }\r\n\r\n  /**\r\n   * 开启预览图窗口\r\n   * @param src - 原图路径或是base64编码\r\n   */\r\n  show(src) {\r\n    this._ui.show(src);\r\n  }\r\n\r\n  /**\r\n   * 关闭预览图窗口\r\n   */\r\n  close() {\r\n    this._ui.close();\r\n  }\r\n\r\n  /**\r\n   * 销毁ui对象\r\n   */\r\n  destroy() {\r\n    this._ui.destroy();\r\n    this._ui = null;\r\n  }\r\n}\r\n"],"file":"image-preview.js"}