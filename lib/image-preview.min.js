"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(e)))return;var r=[];var n=true;var a=false;var i=undefined;try{for(var o=e[Symbol.iterator](),s;!(n=(s=o.next()).done);n=true){r.push(s.value);if(t&&r.length===t)break}}catch(e){a=true;i=e}finally{try{if(!n&&o["return"]!=null)o["return"]()}finally{if(a)throw i}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}function _iterableToArray(e){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){if(t)_defineProperties(e.prototype,t);if(r)_defineProperties(e,r);return e}window.addEventListener("load",function(){var t=new Preview;document.querySelector("img").addEventListener("click",function(e){return t.show(e.target.src)})});var Preview=function(){function e(){_classCallCheck(this,e);this._ui=new(function(){function e(){var t=this;_classCallCheck(this,e);this.tools={createElements:function e(n,a){return _toConsumableArray(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<a)){t.next=7;break}t.next=4;return document.createElement(n);case 4:r++;t.next=1;break;case 7:case"end":return t.stop()}}},e)})())},eDistance:function e(t,r){var n=_slicedToArray(t,2),a=n[0],i=n[1];var o=_slicedToArray(r,2),s=o[0],c=o[1];return Math.sqrt(Math.pow(a-s,2)+Math.pow(i-c,2))}};this.imgArgs={scale:1,rotate:0,translate:["-50%","-50%"],src:"",updateTransformStyle:function e(){return t.imgLayer.style.transform="translate(".concat(t.translate.join(","),") scale(").concat(t.scale,") rotate(").concat(t.rotate,"deg)")},resetImgArgs:function e(){console.log(t.imgLayer);t.imgLayer.setAttribute("style","");t.scale=1;t.rotate=0;t.translate=["-50%","-50%"]}}}_createClass(e,[{key:"createBackgroundLayer",value:function e(){var i=this;this.backgroundLayer=document.createElement("div");this.backgroundLayer.classList.add("preview-background-layer");this.backgroundLayer.addEventListener("click",function(e){var t=["iconfont","preview-img"];for(var r=0,n=t;r<n.length;r++){var a=n[r];if(e.target.classList.contains(a))return}i.close()});["mousewheel","DOMMouseScroll","touchmove"].forEach(function(e){i.backgroundLayer.addEventListener(e,function(e){e.preventDefault()},{passive:false})});document.body.insertBefore(this.backgroundLayer,document.body.firstElementChild)}},{key:"createContentLayer",value:function e(){var r=this;this.contentLayer=document.createElement("div");this.contentLayer.classList.add("content-layer-box");var t=this.tools.createElements("div",3),n=_slicedToArray(t,3),a=n[0],i=n[1],o=n[2];var s=["top-bar","content-img-box","bottom-bar"];[a,i,o].forEach(function(e,t){e.classList.add(s[t]);r.contentLayer.appendChild(e)});var c=this._createBtn(),l=_slicedToArray(c,5),u=l[0],f=l[1],y=l[2],d=l[3],h=l[4];a.appendChild(u);i.appendChild(this._createImg());[f,y,d,h].forEach(function(e){return o.appendChild(e)});this.backgroundLayer.appendChild(this.contentLayer)}},{key:"_createBtn",value:function e(){var t=this;var r=this.tools.createElements("span",5),n=_slicedToArray(r,5),a=n[0],i=n[1],o=n[2],s=n[3],c=n[4];var l=["icon-close","icon-left-rotate","icon-right-rotate","icon-zoom-in","icon-zoom-out"];[a,i,o,s,c].forEach(function(e,t){e.classList.add("iconfont",l[t])});a.addEventListener("click",function(){return t.close()});i.addEventListener("click",function(){return t.rotate-=90});o.addEventListener("click",function(){return t.rotate+=90});s.addEventListener("click",function(){return t.scale+=.2});c.addEventListener("click",function(){return t.scale-=.2});return[a,i,o,s,c]}},{key:"_createImg",value:function e(){var s=this;this.imgLayer=document.createElement("img");this.imgLayer.classList.add("preview-img");this.imgLayer.setAttribute("draggable","false");var i;this.contentLayer.addEventListener("touchmove",function(e){if(e.touches.length===2){s.imgLayer.style.transition="none";var t=[[e.touches[0].clientX,e.touches[0].clientY],[e.touches[1].clientX,e.touches[1].clientY]];if(i&&i.length){var r=s.tools.eDistance(t[0],t[1]);var n=s.tools.eDistance(i[0],i[1]);if(r===n)return;var a=parseFloat((r/n/10).toFixed(2));r>n?s.scale+=a:s.scale-=a}i=t}});this.contentLayer.addEventListener("touchend",function(e){i=undefined;s.imgLayer.style.transition="transform .3s"});var c;var l;var u;var f;var y=false;["mousedown","touchstart"].forEach(function(e){s.imgLayer.addEventListener(e,function(e){e.preventDefault();y=true;s.imgLayer.style.transition="none";c=e.touches?e.touches[0].clientX:e.clientX;l=e.touches?e.touches[0].clientY:e.clientY;u=s.imgLayer.offsetLeft;f=s.imgLayer.offsetTop})});["mousemove","touchmove"].forEach(function(e){s.imgLayer.addEventListener(e,function(e){e.preventDefault();if(y){s.imgLayer.style.transition="none";var t=e.touches?e.touches[0].clientX:e.clientX;var r=e.touches?e.touches[0].clientY:e.clientY;var n=t-c;var a=r-l;var i=a+f;var o=n+u;s.imgLayer.style.top=i+"px";s.imgLayer.style.left=o+"px"}})});["mouseup","mouseleave","touchend"].forEach(function(e){s.imgLayer.addEventListener(e,function(e){e.preventDefault();y=false;s.imgLayer.style.transition="transform .3s"})});["mousewheel","DOMMouseScroll"].forEach(function(e){s.contentLayer.addEventListener(e,function(e){var t=e.detail?e.detail:e.wheelDelta;var r=Math.abs(t)===120;if(r)t>0?s.scale+=.1:s.scale-=.1;else t>0?s.scale-=.1:s.scale+=.1})});return this.imgLayer}},{key:"show",value:function e(t){if(!document.querySelectorAll(".preview-background-layer").length){this.createBackgroundLayer();this.createContentLayer()}this.src=t}},{key:"close",value:function e(){this.backgroundLayer.classList.add("close")}},{key:"destroy",value:function e(){document.body.removeChild(this.backgroundLayer)}},{key:"src",get:function e(){return this.imgArgs.src},set:function e(t){this.imgArgs.src=t;this.imgArgs.resetImgArgs();this.imgLayer.src=t;if(this.backgroundLayer.classList.contains("close"))this.backgroundLayer.classList.remove("close")}},{key:"scale",get:function e(){return this.imgArgs.scale},set:function e(t){this.imgArgs.scale=parseFloat(t.toFixed(2));if(Math.abs(t)<=.5)this.imgArgs.scale=.5;this.imgArgs.updateTransformStyle()}},{key:"rotate",get:function e(){return this.imgArgs.rotate},set:function e(t){this.imgArgs.rotate=t;this.imgArgs.updateTransformStyle()}},{key:"translate",get:function e(){return this.imgArgs.translate},set:function e(t){if(t.length===2)this.imgArgs.translate=t}}]);return e}())}_createClass(e,[{key:"show",value:function e(t){this._ui.show(t)}},{key:"close",value:function e(){this._ui.close()}},{key:"destroy",value:function e(){this._ui.destroy();this._ui=null}}]);return e}();